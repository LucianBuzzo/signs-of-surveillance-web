<!doctype HTML>
<html>

<head>
  <title>Signs of Surveillance</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==" crossorigin="" />

  <!-- Make sure you put this AFTER Leaflet's CSS -->
  <script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js" integrity="sha512-QVftwZFqvtRNi0ZyCtsznlKSWOStnDORoefr1enyq5mVL4tmKB3S/EnC3rRJcxCPavG10IcrVGSmPh6Qw5lwrg==" crossorigin=""></script>
  <!-- load EXIF.js -->
  <script src="js/exif.js"></script>

  <style>
    /* typography and generic styling */
    h1#hero-title {
      font-family: sans-serif;
      /* margin-bottom: -20px;
      z-index: 1000; */
      padding: 0;
    }

    /* mapstyling */

    /* .leaflet-top {
      top: 40px;
      content
    } */

    /* .leaflet-top::before {
      content: "signs of surveillance: ";
    } */

    #mapid {
      height: 680px;
    }

    /* sign styling */
    .sign_popup h1 {
      font-size: 90%;
    }

    .sign_popup p {
      font-size: 90%;
    }

    .sign_popup img {
      width: 200px;
      border: 1px solid grey;
    }
  </style>
</head>

<body>
  <h1 id='hero-title'>Signs of Surveillance</h1>
  <p>Upload a local file to read Exif data.
    <br /> <input id="file-input" type="file" />
  </p>

  <div id="mapid"></div>

  <script>
    var mySigns = [];
    var mymap = L.map('mapid').setView([51.505, -0.09], 13); // LONDON
    //var mymap = L.map('mapid').setView([52.379, 4.899], 13); // AMSTERDAM

    // 52.379189, 4.899431
    //var accessToken = "pk.eyJ1IjoiZGFuYnoiLCJhIjoiY2p0cnN1bXcxMDQ5aTN5bXZ1YmNja2QxNCJ9.Uy4SmkElJKCMLsxy-P8CJQ";

    L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
      attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Map Imagery © <a href="https://www.mapbox.com/">Mapbox</a>, all other materials  © <a href="https://www.buzzo.com/">Daniel Buzzo</a>',
      maxZoom: 20,
      //id: 'mapbox.streets',
      id: 'mapbox.dark',
      id: 'mapbox.light',
      //id: 'mapbox.outdoors',
      //id: 'mapbox.satellite',

      accessToken: 'pk.eyJ1IjoiZGFuYnoiLCJhIjoiY2p0cnN1bXcxMDQ5aTN5bXZ1YmNja2QxNCJ9.Uy4SmkElJKCMLsxy-P8CJQ'
    }).addTo(mymap);


    // var circle = L.circle([51.508, -0.11], {
    //   color: 'red',
    //   fillColor: '#f03',
    //   fillOpacity: 0.5,
    //   radius: 500
    // }).addTo(mymap);

    // var polygon = L.polygon([
    //   [51.509, -0.08],
    //   [51.503, -0.06],
    //   [51.51, -0.047]
    // ]).addTo(mymap);


    //POPUPS STANDALONE
    // var popup = L.popup();

    // function onMapClick(e) {
    //   popup
    //     .setLatLng(e.latlng)
    //     .setContent("You clicked the map at " + e.latlng.toString())
    //     .openOn(mymap);
    // }

    //mymap.on('click', onMapClick);
    function addSigns() {
      var iconLat = 51.505;
      var iconLong = -0.09;
      var maxSigns = 5;

      // to setup signs as custom icons
      for (i = 1; i < maxSigns + 1; i++) {
        ///////// adding signs using icon functionality /////////
        // var myIcon = L.icon({
        //   iconUrl: 'signs/sign' + i + '.jpg',
        //   iconSize: [75, 100],
        //   iconAnchor: [22, 94],
        //   popupAnchor: [-3, -76],
        //   // shadowUrl: 'my-icon-shadow.png',
        //   // shadowSize: [68, 95],
        //   // shadowAnchor: [22, 94]
        // });
        // var newSign = L.marker([iconLat, iconLong + (i / 100.0)], {
        //   icon: myIcon
        // }).addTo(mymap);
        // newSign.bindPopup("<div class ='sign_popup'><h1>DateStamp</h1><p>EXIF data <p> <img src ='signs/sign" + i + ".jpg'></div>");
        /////////        /////////
        var imagePath = "signs/sign" + i + ".jpg";

        var img = new Image();
        img.onload = function () {
           console.log("image " + img.src + " is loaded");
           // load exif data from loaded images in dom
           var img5 = document.getElementById("sign5");
           console.log("image5 " + img5);
           EXIF.getData(img5, function() {
             console.console.log("getdata function");
             var make = EXIF.getTag(this, "Make");
             var model = EXIF.getTag(this, "Model");
             //var makeAndModel = document.getElementById("sign"+ i);
             //makeAndModel.innerHTML = `${make} ${model}`;
             console.log("make & model " + make, model);
           });
        }
        img.src = imagePath;
        ///////// adding signs using markers /////////

        console.log(imagePath);
        var newSign = L.marker([iconLat, iconLong + (i / 100.0)], riseOnHover = true).addTo(mymap);
        newSign.bindPopup("<div class ='sign_popup'><h1>DateStamp</h1><p  >EXIF data <br> <p> <img id='sign" + i + "'src =" + imagePath + "></div>").openPopup();



        /////////     /////////
        mySigns.push(newSign);
      }
    }

    addSigns();
    // BIND POPUPS

    // var marker = L.marker([51.5, -0.09],riseOnHover=true).addTo(mymap);
    // marker.bindPopup("<div class ='sign_popup'><h1>DateStamp</h1><p>EXIF data <p> <img src ='signs/sign1.jpg'></div>").openPopup();
    // circle.bindPopup("I am a circle.");
    // polygon.bindPopup("I am a polygon.");
    //sign2.bindPopup("I am a sign of surveillance.").openPopup();
  </script>


  <script>
    // exif js loading
    document.getElementById("file-input").onchange = function(e) {
      var file = e.target.files[0]
      // console.log(e.target.files[0]);
      if (file && file.name) {
        EXIF.getData(file, function() {
          var exifData = EXIF.pretty(this);
          if (exifData) {
            console.log(exifData);
            var make = EXIF.getTag(this, "Make");
            var model = EXIF.getTag(this, "Model");
            console.log("make and model " + make + model);
            alert(exifData);
          } else {
            alert("No EXIF data found in image '" + file.name + "'.");
          }
        });
      }
    }




    document.getElementById("sign1").onclick = function() {
            EXIF.getData(this, function() {
                var make = EXIF.getTag(this, "Make"),
                    model = EXIF.getTag(this, "Model");
                alert("I was taken by a " + make + " " + model);
            });
        }

  </script>
</body>

</html>
